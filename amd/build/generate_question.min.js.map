{"version":3,"file":"generate_question.min.js","sources":["../src/generate_question.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * qbank_generatequestion generation module.\n *\n * @copyright  ISB Bayern, 2024\n * @author     Dr. Peter Mayer\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Selectors from './selectors';\nimport {makeRequest} from 'local_ai_manager/make_request';\nimport {getString} from 'core/str';\n\nexport const init = () => {\n\n    // Get submit button.\n    const submitbtn = document.getElementById('qbank_qgen_start');\n\n    if (!submitbtn) {\n        return;\n    }\n\n    submitbtn.addEventListener(\"click\", generateQuestion);\n\n    var guidequstions = document.getElementsByClassName(\"qbank_generatequestion_guidequestions\");\n\n    for (var i = 0; i < guidequstions.length; i++) {\n        guidequstions[i].addEventListener('change', generatePrompt, false);\n    }\n};\n\n/**\n * Create new page.\n */\nconst generateQuestion = async () => {\n    // Shows the results box. This should happen before the real result is shown,\n    // in order to inform the user, that we are working on it.\n    // var prompt = document.getElementById(Selectors.elements.divresults).value();\n    document.getElementById(Selectors.elements.divresults).classList.remove(\"hidden\");\n    var waitString = await getString('wait_for_result', 'qbank_generatequestion').then((string) => { return string; }).catch();\n    document.getElementById(Selectors.elements.taResult).value = waitString;\n\n    var prompt = document.getElementById(Selectors.elements.taPrompt).value;\n\n    let options = [];\n\n    retrieveResult('chat', prompt, options).then(requestresult => {\n\n        // Early exit if an error occured. Print out the error message to the output textarea.\n        if (requestresult.string == 'error') {\n            document.getElementById(Selectors.elements.taResult).value = requestresult.result;\n            return;\n        }\n\n        document.getElementById(Selectors.elements.taResult).value = requestresult.result;\n    });\n};\n\n/**\n * Get the async answer from the LLM.\n *\n * @param {string} purpose\n * @param {string} prompt\n * @param {array} options\n * @returns {string}\n */\nconst retrieveResult = async (purpose, prompt, options = []) => {\n    const defaultprompt = await getString('defaultprompt', 'qbank_generatequestion').then((defaultprompt) => {\n        return defaultprompt;\n    });\n\n    const defaultpromtPostfix = await getString('defaultpromt_postfix', 'qbank_generatequestion').then((defaultpromtPostfix) => {\n        return defaultpromtPostfix;\n    });\n\n    prompt = defaultprompt + \" \" + prompt + \" \" + defaultpromtPostfix;\n\n    window.console.log(prompt );\n    let result = await makeRequest(purpose, prompt, JSON.stringify(options));\n    return result;\n};\n\nconst generatePrompt = async () => {\n\n    const qtypehortname = document.getElementById(Selectors.elements.qtypeshortname).value;\n\n    var  qtypeWrapperPrompt = await getString('qtype_wrapperprompt', 'qbank_generatequestion', 'qtype_' + qtypehortname).then((string) => { return string; }).catch();\n    qtypeWrapperPrompt = qtypeWrapperPrompt + \" \" + await getString('qtype_' + qtypehortname + '_special_prompt', 'qbank_generatequestion', 'qtype_' + qtypehortname).then((string) => { return string; }).catch();\n\n    const mathequation = document.getElementById(Selectors.elements.mathequation).value;\n    var matheqdefaultprompt = \"\";\n    if (mathequation == 1) {\n        matheqdefaultprompt = await getString('defaultprompt_math', 'qbank_generatequestion').then((string) => { return string; }).catch();\n    }\n\n    const qTitle = document.getElementById(Selectors.elements.qtitle).value;\n    const question = document.getElementById(Selectors.elements.question).value;\n    const questionPrompt = await getString('question_wrapperprompt', 'qbank_generatequestion', question).then((string) => { return string; }).catch();\n\n    // const defaultprompt = await getString('defaultprompt', 'qbank_generatequestion').then((string) => {return string;}).catch();\n    const qTitleString = await getString('question_title_wrapperprompt', 'qbank_generatequestion', qTitle).then((string) => { return string; }).catch();\n\n    var prompt = qtypeWrapperPrompt + \" \" + matheqdefaultprompt + \" \" + qTitleString + \" \" + questionPrompt;\n    document.getElementById(Selectors.elements.taPrompt).value = prompt;\n    // window.console.log(qtypeshortname);\n    // window.console.log(matheqdefaultprompt);\n    // window.console.log(qtitle);\n    // window.console.log(question);\n    // window.console.log(defaultprompt);\n};\n"],"names":["submitbtn","document","getElementById","addEventListener","generateQuestion","guidequstions","getElementsByClassName","i","length","generatePrompt","async","Selectors","elements","divresults","classList","remove","waitString","then","string","catch","taResult","value","prompt","taPrompt","retrieveResult","requestresult","result","purpose","options","defaultprompt","defaultpromtPostfix","window","console","log","JSON","stringify","qtypehortname","qtypeshortname","qtypeWrapperPrompt","matheqdefaultprompt","mathequation","qTitle","qtitle","question","questionPrompt"],"mappings":";;;;;;;8JA2BoB,WAGVA,UAAYC,SAASC,eAAe,uBAErCF,WAILA,UAAUG,iBAAiB,QAASC,0BAEhCC,cAAgBJ,SAASK,uBAAuB,yCAE3CC,EAAI,EAAGA,EAAIF,cAAcG,OAAQD,IACtCF,cAAcE,GAAGJ,iBAAiB,SAAUM,gBAAgB,WAO9DL,iBAAmBM,UAIrBT,SAASC,eAAeS,mBAAUC,SAASC,YAAYC,UAAUC,OAAO,cACpEC,iBAAmB,kBAAU,kBAAmB,0BAA0BC,MAAMC,QAAoBA,SAAWC,QACnHlB,SAASC,eAAeS,mBAAUC,SAASQ,UAAUC,MAAQL,eAEzDM,OAASrB,SAASC,eAAeS,mBAAUC,SAASW,UAAUF,MAIlEG,eAAe,OAAQF,OAFT,IAE0BL,MAAKQ,gBAGrCA,cAAcP,OAKlBjB,SAASC,eAAeS,mBAAUC,SAASQ,UAAUC,MAAQI,cAAcC,WAY7EF,eAAiBd,eAAOiB,QAASL,YAAQM,+DAAU,SAC/CC,oBAAsB,kBAAU,gBAAiB,0BAA0BZ,MAAMY,eAC5EA,gBAGLC,0BAA4B,kBAAU,uBAAwB,0BAA0Bb,MAAMa,qBACzFA,sBAGXR,OAASO,cAAgB,IAAMP,OAAS,IAAMQ,oBAE9CC,OAAOC,QAAQC,IAAIX,YACfI,aAAe,6BAAYC,QAASL,OAAQY,KAAKC,UAAUP,iBACxDF,QAGLjB,eAAiBC,gBAEb0B,cAAgBnC,SAASC,eAAeS,mBAAUC,SAASyB,gBAAgBhB,UAE5EiB,yBAA2B,kBAAU,sBAAuB,yBAA0B,SAAWF,eAAenB,MAAMC,QAAoBA,SAAWC,QAC1JmB,mBAAqBA,mBAAqB,UAAY,kBAAU,SAAWF,cAAgB,kBAAmB,yBAA0B,SAAWA,eAAenB,MAAMC,QAAoBA,SAAWC,YAGnMoB,oBAAsB,GACN,GAFCtC,SAASC,eAAeS,mBAAUC,SAAS4B,cAAcnB,QAG1EkB,0BAA4B,kBAAU,qBAAsB,0BAA0BtB,MAAMC,QAAoBA,SAAWC,eAGzHsB,OAASxC,SAASC,eAAeS,mBAAUC,SAAS8B,QAAQrB,MAC5DsB,SAAW1C,SAASC,eAAeS,mBAAUC,SAAS+B,UAAUtB,MAChEuB,qBAAuB,kBAAU,yBAA0B,yBAA0BD,UAAU1B,MAAMC,QAAoBA,SAAWC,YAKtIG,OAASgB,mBAAqB,IAAMC,oBAAsB,UAFnC,kBAAU,+BAAgC,yBAA0BE,QAAQxB,MAAMC,QAAoBA,SAAWC,QAEzD,IAAMyB,eACzF3C,SAASC,eAAeS,mBAAUC,SAASW,UAAUF,MAAQC"}